<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LedgerLive â€” Suppliers</title>
  <link rel="stylesheet" href="ledgerlive-style.css">
  <style>
    .page { padding: 22px; }
    .form-grid { display:flex; gap:12px; flex-wrap:wrap; }
    .form-grid input { flex:1; min-width:160px; padding:8px; }
    .small-btn { padding:8px 10px; border-radius:6px; border:none; cursor:pointer; }
    .small-btn.primary { background:#2563eb; color:#fff; }
    .small-btn.danger { background:#dc2626; color:#fff; }
    table td.actions { width:150px; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">LedgerLive</div>
    <ul>
      <li onclick="location.href='dashboard.html'">ğŸ“Š Dashboard</li>
      <li onclick="location.href='sales.html'">ğŸ’° Sales</li>
      <li onclick="location.href='inventory.html'">ğŸ“¦ Inventory</li>
      <li class="active" onclick="location.href='suppliers.html'">ğŸšš Suppliers</li>
      <li onclick="location.href='reports.html'">ğŸ“‘ Reports</li>
      <li onclick="location.href='settings.html'">âš™ï¸ Settings</li>
    </ul>
  </aside>

  <!-- Main -->
  <main class="main page">
    <h1>ğŸšš Suppliers</h1>

    <div class="section-card">
      <h3>Add / Update Supplier</h3>
      <div class="form-grid" style="margin-top:10px;">
        <input id="s_name" placeholder="Supplier name (unique)" />
        <input id="s_contact" placeholder="Contact (phone / email)" />
        <input id="s_products" placeholder="Products (comma separated)" />
        <button id="btnSaveSupplier" class="small-btn primary">Save</button>
      </div>
      <p style="color:#6b7280; margin-top:8px;">Click an existing supplier to edit. Name is used as identifier for update.</p>
    </div>

    <div class="table-card">
      <h3 style="margin-bottom:8px;">Suppliers List</h3>
      <table id="suppliersTable">
        <thead>
          <tr><th>Name</th><th>Contact</th><th>Products</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

<script>
  const KEY = 'suppliers';
  let suppliers = JSON.parse(localStorage.getItem(KEY) || '[]');

  const tbody = document.querySelector('#suppliersTable tbody');
  const nameInput = document.getElementById('s_name');
  const contactInput = document.getElementById('s_contact');
  const productsInput = document.getElementById('s_products');
  const saveBtn = document.getElementById('btnSaveSupplier');

  function render() {
    suppliers = JSON.parse(localStorage.getItem(KEY) || '[]');
    tbody.innerHTML = '';
    suppliers.forEach((s, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(s.name)}</td>
        <td>${escapeHtml(s.contact || '')}</td>
        <td>${escapeHtml((s.products||[]).join(', '))}</td>
        <td class="actions">
          <button class="small-btn" onclick="editSupplier(${i})">Edit</button>
          <button class="small-btn danger" onclick="deleteSupplier(${i})">Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function escapeHtml(str){ return String(str||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  saveBtn.addEventListener('click', () => {
    const name = nameInput.value.trim();
    if(!name) return alert('Enter supplier name');
    const contact = contactInput.value.trim();
    const products = productsInput.value.split(',').map(x=>x.trim()).filter(Boolean);

    const idx = suppliers.findIndex(s => s.name.toLowerCase() === name.toLowerCase());
    if(idx >= 0){
      suppliers[idx].contact = contact;
      suppliers[idx].products = products;
    } else {
      suppliers.push({ name, contact, products });
    }

    localStorage.setItem(KEY, JSON.stringify(suppliers));
    localStorage.setItem('suppliers-update', Date.now());
    nameInput.value = contactInput.value = productsInput.value = '';
    render();
  });

  function editSupplier(i){
    const s = suppliers[i];
    nameInput.value = s.name;
    contactInput.value = s.contact || '';
    productsInput.value = (s.products||[]).join(', ');
  }

  function deleteSupplier(i){
    if(!confirm('Delete supplier?')) return;
    suppliers.splice(i,1);
    localStorage.setItem(KEY, JSON.stringify(suppliers));
    localStorage.setItem('suppliers-update', Date.now());
    render();
  }

  // Live sync updates from other tabs
  window.addEventListener('storage', (e) => {
    if(['suppliers','suppliers-update'].includes(e.key)) render();
  });

  // initial render
  render();
</script>
</body>
</html>
