<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dynamic Inventory ‚Äì LedgerLive</title>
  <link rel="stylesheet" href="ledgerlive-style.css" />
  <style>
    
/* === Inventory Page Specific Styling === */
.flex-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-top: 1rem;
}

.half {
  flex: 1 1 45%;
  min-width: 220px;
}

#newField {
  width: 100%;
  padding: 8px;
  border: 1px solid var(--gray-mid);
  border-radius: 6px;
  background-color: #fff;
  font-size: 0.95rem;
}

/* Add Field Button */
#addFieldBtn {
  background: var(--primary);
  background-color:  #2c7a4b;
  color: black;
  border: none;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.3s;
}
#addFieldBtn:hover {
  background: var(--primary-dark);
  background-color: #90EE90;
}

/* === Field Badges === */
.field-badge {
  display: inline-block;
  background-color: var(--accent);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  margin-right: 8px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: background 0.2s;
}
.field-badge:hover {
  background-color: var(--primary-dark);
}

/* === Dynamic Product Form === */
#productForm {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

#productForm label {
  display: block;
  font-weight: 500;
  margin-bottom: 4px;
  color: var(--text-dark);
  font-size: 0.9rem;
}

#productForm input {
  width: 100%;
  padding: 8px;
  border: 1px solid var(--gray-mid);
  border-radius: 6px;
  background: #fff;
  font-size: 0.9rem;
}

#productForm .add-btn {
  grid-column: 1 / -1;
  justify-self: start;
  background: var(--primary);
  background-color:  #2c7a4b;
  color: #fff;
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 500;
  transition: background 0.3s;
}
#productForm .add-btn:hover {
  background: var(--primary-dark);
   background-color: #90EE90;
}

/* === Inventory Table === */
.inventory-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1.5rem;
  background-color: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}

.inventory-table th {
  background-color: var(--primary);
  color:black;
  padding: 10px;
  font-size: 0.9rem;
  text-align: center;
}

.inventory-table td {
  padding: 10px;
  border-bottom: 1px solid var(--gray-mid);
  text-align: center;
  font-size: 0.9rem;
  color: var(--text-dark);
}

.inventory-table tr:nth-child(even) {
  background-color: #f9fafb;
}

.inventory-table tr:last-child td {
  border-bottom: none;
}

/* === Table Action Buttons === */
.action-btn {
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 0.85rem;
  font-weight: 500;
  cursor: pointer;
  border: none;
  transition: background 0.2s;
}

.delete-btn {
  background: var(--danger);
  background-color: #b91c1c;
  color: #fff;
}
.delete-btn:hover {
  background: #b91c1c;
}

  </style>
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">LedgerLive</div>
    <ul>
      <li onclick="location.href='dashboard.html'">üìä Dashboard</li>
      <li onclick="location.href='sales.html'">üí∞ Sales</li>
      <li class="active" onclick="location.href='inventory.html'">üì¶ Inventory</li>
      <li onclick="location.href='suppliers.html'">üöö Suppliers</li>
      <li onclick="location.href='reports.html'">üìë Reports</li>
      <li onclick="location.href='settings.html'">‚öôÔ∏è Settings</li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <h1>üì¶ Dynamic Inventory</h1>

    <!-- STEP 1: Define fields -->
    <h3>1Ô∏è‚É£ Define Product Fields</h3>
    <div class="flex-row">
      <div class="half">
        <label for="newField">Add New Field Name:</label>
        <input type="text" id="newField" placeholder="e.g. Type, Brand, Size" />
      </div>
      <div class="half" style="align-self: flex-end;">
        <button id="addFieldBtn" class="btn" style="color: #fff;">Add Field</button>
      </div>
    </div>
    <div id="fieldList" style="margin-top:1rem;"></div>

    <!-- STEP 2: Add Product dynamically -->
    <h3 style="margin-top:2rem;">2Ô∏è‚É£ Add Product</h3>
    <form id="productForm"></form>

    <!-- STEP 3: Table -->
    <h3 style="margin-top:2rem;">üßæ Inventory Table</h3>
    <table class="inventory-table" id="inventoryTable">
      <thead><tr id="tableHead"></tr></thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
/* ---------- CONFIG KEYS ---------- */
const fieldKey = "dynamicFields";
const inventoryKey = "dynamicInventory";

/* ---------- STATE ---------- */
let fields = JSON.parse(localStorage.getItem(fieldKey)) || [];
let inventory = JSON.parse(localStorage.getItem(inventoryKey)) || [];
let editingIndex = null; // ‚úÖ This is required

/* ---------- DOM ---------- */
const addFieldBtn = document.getElementById("addFieldBtn");
const newFieldInput = document.getElementById("newField");
const fieldList = document.getElementById("fieldList");
const form = document.getElementById("productForm");
const tableHead = document.getElementById("tableHead");
const tableBody = document.querySelector("#inventoryTable tbody");

/* ---------- HELPERS ---------- */
function logState(msg) {
  console.log("InventoryDebug:", msg, { fields, inventory });
}

function saveFields() {
  localStorage.setItem(fieldKey, JSON.stringify(fields));
}
function saveInventory() {
  localStorage.setItem(inventoryKey, JSON.stringify(inventory));
}

/* ---------- UI RENDERS ---------- */
function renderFields() {
  fieldList.innerHTML = "";
  fields.forEach(f => {
    // Badge shows field and clickable X
    const badge = document.createElement("span");
    badge.textContent = f + " ‚úï";
    badge.className = "field-badge";
    badge.style.userSelect = "none";
    badge.onclick = () => removeField(f);
    fieldList.appendChild(badge);
  });
}

function renderForm() {
  form.innerHTML = "";

  // Use grid-like layout by letting CSS handle it; wrap each label+input+btn in a block div
  fields.forEach(f => {
    const block = document.createElement("div");
    block.style.display = "flex";
    block.style.alignItems = "center";
    block.style.gap = "8px";
    block.style.marginBottom = "6px";

    const label = document.createElement("label");
    label.textContent = f + ":";
    label.style.minWidth = "110px";

    const input = document.createElement("input");
    input.type = "text";
    input.name = f;
    input.required = true;
    input.style.flex = "1";

    const removeBtn = document.createElement("button");
    removeBtn.type = "button";
    removeBtn.textContent = "üóëÔ∏è";
    removeBtn.title = `Remove field "${f}"`;
    removeBtn.style.border = "none";
    removeBtn.style.padding = "6px 8px";
    removeBtn.style.cursor = "pointer";
    removeBtn.style.borderRadius = "6px";
    removeBtn.style.background = "#b91c1c";
    removeBtn.style.color = "white";
    removeBtn.onclick = () => removeField(f);

    block.appendChild(label);
    block.appendChild(input);
    block.appendChild(removeBtn);
    form.appendChild(block);
  });

  if (fields.length > 0) {
    const btn = document.createElement("button");
    btn.type = "submit";
    btn.textContent = "Add Product";
    btn.className = "btn add-btn";
    btn.style.marginTop = "8px";
    form.appendChild(btn);
  }
}

function renderTableHeader() {
  tableHead.innerHTML = "";
  fields.forEach(f => {
    const th = document.createElement("th");
    th.textContent = f;
    tableHead.appendChild(th);
  });
  if (fields.length) {
    const th = document.createElement("th");
    th.textContent = "Actions";
    tableHead.appendChild(th);
  }
}

function renderTableBody() {
  tableBody.innerHTML = "";
  inventory.forEach((item, index) => {
    const row = document.createElement("tr");

    fields.forEach(f => {
      const td = document.createElement("td");
      td.textContent = item[f] ?? "";
      row.appendChild(td);
    });

    const tdActions = document.createElement("td");

    // Edit button
    const editBtn = document.createElement("button");
    editBtn.textContent = "Edit";
    editBtn.className = "action-btn";
    editBtn.style.background = "#2563eb";
    editBtn.style.color = "#fff";
    editBtn.style.marginRight = "6px";
    editBtn.onclick = () => editProduct(index);
    tdActions.appendChild(editBtn);

    // Delete button
    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.className = "action-btn delete-btn";
    delBtn.onclick = () => {
      if (!confirm("Delete this product?")) return;
      inventory.splice(index, 1);
      saveInventory();
      renderTableBody();
    };
    tdActions.appendChild(delBtn);

    row.appendChild(tdActions);
    tableBody.appendChild(row);
  });
}
function editProduct(index) {
  const product = inventory[index];
  editingIndex = index;

  // Fill form inputs with product data
  fields.forEach(f => {
    const input = form.elements[f];
    if (input) input.value = product[f] ?? "";
  });

  // Change Add button to Update button
  const submitBtn = form.querySelector("button[type='submit']");
  if (submitBtn) submitBtn.textContent = "Update Product";
}



/* ---------- ADD FIELD ---------- */
addFieldBtn.addEventListener("click", () => {
  const fieldName = newFieldInput.value.trim();
  if (!fieldName) return alert("Enter a valid field name.");
  if (fields.includes(fieldName)) return alert("Field already exists!");
  fields.push(fieldName);
  saveFields();
  renderFields();
  renderForm();
  renderTableHeader();
  newFieldInput.value = "";
  logState(`Added field "${fieldName}"`);
});

/* ---------- REMOVE FIELD (robust) ---------- */
function removeField(field) {
  try {
    if (!fields.includes(field)) {
      console.warn("Attempted to remove non-existent field:", field);
      return;
    }
    if (!confirm(`Remove field "${field}" and delete its values from all products?`)) return;

    // Remove from fields array
    fields = fields.filter(f => f !== field);

    // Rebuild inventory immutably: drop the property on each item
    inventory = inventory.map(item => {
      if (!item || typeof item !== "object") return item;
      if (!(field in item)) return item;
      const { [field]: _removed, ...rest } = item;
      return rest;
    });

    // Persist and re-render
    saveFields();
    saveInventory();
    renderFields();
    renderForm();
    renderTableHeader();
    renderTableBody();

    // small timestamp to notify other tabs/listeners
    localStorage.setItem("dynamicInventory_lastUpdate", Date.now());

    logState(`Removed field "${field}"`);
  } catch (err) {
    console.error("removeField error:", err);
    alert("An error occurred while removing the field. Check console for details.");
  }
}

/* ---------- PRODUCT SUBMIT ---------- */
form.addEventListener("submit", e => {
  e.preventDefault();
  if (fields.length === 0) return alert("Add at least one field first.");

  const newItem = {};
  let valid = true;

  fields.forEach(f => {
    const value = form.elements[f]?.value.trim() || "";
    if (!value) valid = false;
    newItem[f] = value;
  });

  if (!valid) return alert("Please fill all fields.");

  if (editingIndex !== null) {
    // Update existing product
    inventory[editingIndex] = newItem;
    editingIndex = null;

    const submitBtn = form.querySelector("button[type='submit']");
    if (submitBtn) submitBtn.textContent = "Add Product";
  } else {
    // Add new product
    inventory.push(newItem);
  }

  saveInventory();
  renderTableBody();
  form.reset();
});


/* ---------- INIT ---------- */
(function init() {
  try {
    renderFields();
    renderForm();
    renderTableHeader();
    renderTableBody();
    logState("Initial render complete");
  } catch (err) {
    console.error("init error:", err);
  }
})();

/* ---------- DEBUG: listen for storage changes (optional helpful) ---------- */
window.addEventListener("storage", (ev) => {
  if (!ev.key) return;
  if (ev.key === fieldKey || ev.key === inventoryKey || ev.key === "dynamicInventory_lastUpdate") {
    // re-sync state from storage (another tab might have changed it)
    fields = JSON.parse(localStorage.getItem(fieldKey)) || [];
    inventory = JSON.parse(localStorage.getItem(inventoryKey)) || [];
    renderFields();
    renderForm();
    renderTableHeader();
    renderTableBody();
    console.log("InventoryDebug: storage event applied", ev.key);
  }
});
</script>


  
</body>
</html> 